function _slicedToArray(r,e){return _arrayWithHoles(r)||_iterableToArrayLimit(r,e)||_unsupportedIterableToArray(r,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(r,a){var t;if(r)return"string"==typeof r?_arrayLikeToArray(r,a):"Map"===(t="Object"===(t={}.toString.call(r).slice(8,-1))&&r.constructor?r.constructor.name:t)||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}function _iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}function _arrayWithHoles(r){if(Array.isArray(r))return r}window.affWPCustomLink=window.affWPCustomLink||($=>{var vars=affWpCustomLinksVars,el={},app={customLink:{},notices:null,noticesTimeout:3e3,init:function(){$(app.ready)},ready:function(){el={$url:$("#affwp-url"),$campaign:$("#affwp-campaign"),$campaignBtn:$("#affwp-generator-toggle-campaign"),$form:$("#affwp-custom-link-generator"),$table:$("#affwp-custom-links-table"),$notices:$("#affwp-generator-submit-notices"),$submitBtn:$("#affwp-generator-submit-btn")},app.events()},events:function(){el.$form.on("submit",app.onSave),el.$table.on("click",".affwp-custom-link",app.onCopy),el.$table.on("click",".affwp-edit-custom-link",app.onEdit),el.$campaign.on("focusout",app.cleanCampaignWhitespaces),el.$campaignBtn.on("click",app.onClickCampaignBtn),app.initializeSubmissionNotices(),app.updateTooltips()},initializeSubmissionNotices:function(){app.notices=tippy(el.$notices.get(0),{content:"",trigger:"manual",placement:"top",animation:"fade",hideOnClick:!1})},updateTooltips:function(){app.initializeButtons(".affwp-tooltip-url-copy:not(.affwp-tooltip-initialized)","click",vars.i18n.copied,1e3),app.initializeButtons(".affwp-tooltip-button-copy:not(.affwp-tooltip-initialized)","mouseenter focus",vars.i18n.copied,1e3,vars.i18n.copy_affiliate_link,!0),app.initializeButtons(".affwp-tooltip-edit:not(.affwp-tooltip-initialized)","mouseenter focus",vars.i18n.edit_affiliate_link,0)},initializeButtons:function(className,trigger,content,hideDelay){var resetContent=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,manualTrigger=5<arguments.length&&void 0!==arguments[5]&&arguments[5];document.querySelectorAll(className).forEach(function(button){var instance=tippy(button,{trigger:trigger,duration:[300,250],hideOnClick:!1,onCreate:function(instance){instance.reference.classList.add("affwp-tooltip-initialized")}});button.addEventListener("click",function(){return app.handleButtonClick(instance,content,hideDelay,resetContent,manualTrigger)})})},handleButtonClick:function(instance,content,hideDelay){var resetContent=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,manualTrigger=4<arguments.length&&void 0!==arguments[4]&&arguments[4];instance.setContent(content),instance.show(),manualTrigger&&instance.setProps({trigger:"manual"}),setTimeout(function(){instance.hide(),manualTrigger&&instance.setProps({trigger:"mouseenter focus"})},hideDelay),resetContent&&instance.setProps({onHidden:function(){instance.setContent(resetContent),instance.setProps({onHidden:null})}})},cleanCampaignWhitespaces:function(){el.$campaign.val(el.$campaign.val().replace(/\s/g,""))},onCopy:function(event){event.preventDefault(),app.copyToClipboard($(this).closest("tr").data("custom-link-id"))},onEdit:function(event){event.preventDefault();var event=$(this).closest("tr"),url=new URL(event.data("custom-link")),url=new URLSearchParams(url.search).get("campaign");el.$url.val(event.data("destination-link")).focus(),el.$form.find(".affwp-custom-link-id").val(event.data("custom-link-id")),el.$submitBtn.val(vars.i18n.custom_link_btn_update),app.hideCampaign(""),url&&app.showCampaign(url)},onSave:function(event){event.preventDefault(),app.queryCustomLink();event=app.parseUrl(app.customLink.URL);null===event?app.showNotice(vars.i18n.invalid_url):app.save(event.toString(),app.customLink.campaign,app.customLink.ID)},getTableRowHtml:function(fields){var tableRowHtml=vars.template;return Object.entries(fields).forEach(function(_ref){var _ref=_slicedToArray(_ref,2),key=_ref[0],_ref=_ref[1];tableRowHtml=tableRowHtml.replace(new RegExp("{{\\b".concat(key,"\\b}}"),"g"),_ref)}),tableRowHtml},save:function(url){var campaign=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",customLinkId=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;"string"==typeof url&&app.isValidUrlString(url)?$.ajax({type:"POST",url:vars.ajax_url,data:{action:"affwp_save_custom_link",nonce:vars.nonce,url:url,campaign:campaign,custom_link_id:customLinkId},dataType:"json",beforeSend:function(){app.lockForm(),app.showNotice(vars.i18n.saving,"success",0)},success:function(response){var $tableRow;response.success?(app.customLink.ID=response.data.fields.ID,el.$table.removeClass("affwp-hidden"),$tableRow=$(app.getTableRowHtml(response.data.fields)),response.data.updated?(el.$table.find('tbody tr[data-custom-link-id="'.concat(app.customLink.ID,'"]')).replaceWith($tableRow),setTimeout(function(){app.resetForm()},app.noticesTimeout)):(el.$table.find("tbody").prepend($tableRow),app.resetForm()),app.updateTooltips(),navigator&&navigator.clipboard?navigator.clipboard.writeText($tableRow.data("custom-link")).then(function(){app.showNotice(response.data.updated?vars.i18n.successfully_updated_and_copied:vars.i18n.successfully_created_and_copied,"success")}).catch(function(){app.showNotice(response.data.message,"success")}):app.showNotice(response.data.message,"success")):app.showNotice(response.data.message)},complete:function(response){response.responseJSON&&response.responseJSON.data&&response.responseJSON.data.updated||app.unlockForm()}}).fail(function(response){app.showNotice(vars.i18n.invalid_request)}):console.error("Can not save. You must supply a valid url string.")},lockForm:function(){el.$campaign.attr("disabled",!0),el.$url.attr("disabled",!0),el.$submitBtn.attr("disabled",!0)},unlockForm:function(){el.$campaign.attr("disabled",!1),el.$url.attr("disabled",!1),el.$submitBtn.attr("disabled",!1)},resetForm:function(){el.$form.find(".affwp-custom-link-id").val(0),el.$submitBtn.val(vars.i18n.custom_link_btn_create),el.$url.val(""),app.unlockForm(),app.hideCampaign("")},queryCustomLink:function(){app.customLink={ID:parseInt(el.$form.find('input[type="hidden"].affwp-custom-link-id').val()),affiliateID:parseInt(el.$form.find('input[type="hidden"].affwp-affiliate-id').val()),URL:el.$url.val().toString(),campaign:el.$campaign.val().toString()}},copyToClipboard:function(customLinkID){customLinkID=el.$table.find('tbody tr[data-custom-link-id="'.concat(customLinkID,'"]'));customLinkID.length&&!customLinkID.find(".affwp-copy-custom-link").hasClass("copied")&&navigator&&navigator.clipboard&&navigator.clipboard.writeText(customLinkID.data("custom-link"))},showNotice:function(message){var timeout="number"==typeof(timeout=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)?parseInt(timeout):parseInt(app.noticesTimeout);app.notices.setContent(message),app.notices.show(),0<timeout&&setTimeout(function(){app.notices.hide()},timeout)},showCampaign:function(){var content=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;"string"==typeof content&&el.$campaign.val(content),el.$form.find(".affwp-generator-campaign-text-link-wrap").addClass("affwp-hidden"),el.$form.find(".affwp-campaign-wrap").removeClass("affwp-hidden")},hideCampaign:function(){var content=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;"string"==typeof content&&el.$campaign.val(content),el.$form.find(".affwp-campaign-wrap").addClass("affwp-hidden"),el.$form.find(".affwp-generator-campaign-text-link-wrap").removeClass("affwp-hidden")},onClickCampaignBtn:function(event){event.preventDefault(),app.showCampaign("")},isValidUrlString:function(url){return/^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(url)},parseUrl:function(url){return"string"!=typeof url?(console.error("Url must be a string."),null):(url=url.trim().replace(/([^:])(\/\/+)/g,"$1/").replace(/ /g,"%20"),app.isValidUrlString(url)?new URL(url):null)}};return app})(jQuery),affWPCustomLink.init();