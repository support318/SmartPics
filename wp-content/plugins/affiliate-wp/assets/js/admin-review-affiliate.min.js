jQuery(document).ready(function(){affiliatewp?(affiliatewp.attach("affiliateReview",{$cache:{},localStorageAIAnswerCacheExpiry:30,force:!1,$:function(selector){var _this$$cache$selector;return null!=(_this$$cache$selector=this.$cache[selector])?_this$$cache$selector:this.$cache[selector]=jQuery(selector)},$ready:function(){this.$('input[name="decision"]').on("change",this.$showRejectTextAreaOnReject),this.$('input[name="decision"]').on("change",this.$switchButtonTexts),this.$('input[name="decision"]').on("change",this.$undecidedAffiliate),this.$('button[name="ask-ai"]').on("click",this.$askAI)},getAffiliateID:function(){return this.$("#affwp_review_affiliate").data("affiliate-id")},$undecidedAffiliate:function(){affiliatewp.affiliateReview.undecidedAffiliate(jQuery(this).val())},undecidedAffiliate:function(decision){var $skip=this.$('input[name="undecided"]',!1),affiliateID=this.getAffiliateID();"undecided"===decision?$skip.val($skip.val()+",".concat(affiliateID)):$skip.val($skip.val().replace(",".concat(affiliateID),""))},$switchButtonTexts:function(){var _jQuery$val;affiliatewp.affiliateReview.syncActionButtonTextsWithDecision(null!=(_jQuery$val=jQuery(this).val())?_jQuery$val:"")},syncActionButtonTextsWithDecision:function(decisionValue){var $exit=this.$('input[name="exit"][type="submit"]'),$continue=this.$('input[name="continue"][type="submit"]');$exit.attr("value",null!=($exit=$exit.data("value-".concat(decisionValue)))?$exit:""),$continue.attr("value",null!=($exit=$continue.data("value-".concat(decisionValue)))?$exit:"")},$askAI:function(){var _jQuery$data;affiliatewp.affiliateReview.setAskAIButtonDisabled(!0),affiliatewp.affiliateReview.reviewAffiliate(null!=(_jQuery$data=jQuery(this).data("affiliate-id"))?_jQuery$data:0)},hideAskAIButton:function(hide){hide?this.$('button[name="ask-ai"]').hide():this.$('button[name="ask-ai"]').show()},$showRejectTextAreaOnReject:function(){"reject"===jQuery(this).val()?(affiliatewp.affiliateReview.$("#affwp-rejection-reason").removeClass("hidden"),affiliatewp.affiliateReview.$('textarea[name="affwp_rejection_reason"]').trigger("focus")):affiliatewp.affiliateReview.$("#affwp-rejection-reason").addClass("hidden")},reviewAffiliate:function(affiliateID){this.hasValidLicense?(this.$(".decision-container").addClass("asking-ai"),this.setAllButtonsDisabled(!0),this.setAskingAI(!0),this.secureDataForProxy(this.hash,affiliateID,function(secureJSON,hash){var cachedAIStatus=this.getCachedAIAnswer(affiliateID,"status"),cachedAIReason=this.getCachedAIAnswer(affiliateID,"reason"),cachedAIRejectionMessage=this.getCachedAIAnswer(affiliateID,"rejection_message");"rejected"!==cachedAIStatus&&"accepted"!==cachedAIStatus||""===cachedAIReason?this.makeProxyAIRequest(secureJSON,hash,function(aiStatus,aiReason,aiRejectionMessage,applicationsLeft,fullResponse){this.updateApplicationsLeft(applicationsLeft),this.displayAIAnswer(aiReason,aiStatus),this.cacheAIAnswer(affiliateID,aiStatus,aiReason,aiRejectionMessage),this.setAskAIButtonDisabled(!0),"rejected"===aiStatus&&this.setRejectionMessage(aiRejectionMessage)}):(this.displayAIAnswer(cachedAIReason,cachedAIStatus),""!==cachedAIRejectionMessage&&this.setRejectionMessage(cachedAIRejectionMessage),this.setAskAIButtonDisabled(!0))})):this.displayLicenseErrorModal()},updateApplicationsLeft:function(applicationsLeft){this.$("span.ai-reviews-left span.count").html(applicationsLeft.toLocaleString())},logUsage:function(aiResponse){jQuery.ajax({url:this.ajaxURL,method:"POST",dataType:"json",data:{action:"log_affiliate_review_ai_usage",_ajax_nonce:this.nonce,response:aiResponse}})},setRejectionMessage:function(message){var _this=this;void 0!==message&&""!==message&&(this.setActionButtonsDisabled(!0),window.setTimeout(function(){return _this.aiStreamContent('textarea[name="affwp_rejection_reason"]',message,function(app){app.setActionButtonsDisabled(!1)})},1e3))},getAICacheKey:function(affiliateID,dataKey){return"AffiliateWPReviewWithAICachedResponse:".concat(dataKey,":").concat(affiliateID)},getCachedAIAnswer:function(affiliateID,dataKey,expiresInSeconds){if(this.useCaches){void 0===expiresInSeconds&&(expiresInSeconds=this.localStorageAIAnswerCacheExpiry);var updated=window.localStorage.getItem(this.getAICacheKey(affiliateID,"updated"));if(!(Date.now()-Number(updated)>1e3*Number(expiresInSeconds)))return null!=(updated=window.localStorage.getItem(this.getAICacheKey(affiliateID,dataKey)))?updated:""}},cacheAIAnswer:function(affiliateID,aiStatus,aiReason,aiRejectionMessage){window.localStorage.setItem(this.getAICacheKey(affiliateID,"reason"),aiReason),window.localStorage.setItem(this.getAICacheKey(affiliateID,"status"),aiStatus),window.localStorage.setItem(this.getAICacheKey(affiliateID,"rejection_message"),aiRejectionMessage),window.localStorage.setItem(this.getAICacheKey(affiliateID,"updated"),Date.now())},displayAIAnswer:function(aiReason,aiStatus){return this.setAllButtonsDisabled(!1),this.setAIError(!1),this.aiStreamContent(".ai-reason",aiReason),this.$('input[name="ai_reason"]').val(aiReason),this.$('input[name="ai_status"]').val(aiStatus),this.setAIAnswered(!0),"accepted"===aiStatus?this.setAIAffiliateAccepted():this.setAIAffiliateRejected()},setAIError:function(hasError,error){return this.setAskingAI(!1),this.setAIAnswered(!1),hasError?this.$('input[name="ask-ai"]').addClass("error").addClass(error):this.$('input[name="ask-ai"]').removeClass("error").removeClass(error)},setAIAnswered:function(answered){return this.setAskingAI(!answered),answered?this.$(".decision-container").addClass("ai-answered"):this.$(".decision-container").removeClass("ai-answered")},setAskingAI:function(asking){asking?this.$(".decision-container").addClass("asking-ai").removeClass("ai-answered"):this.$(".decision-container").removeClass("asking-ai ai-answered")},setAIAffiliateAccepted:function(){this.$('input[type="radio"][value="accept"]').prop("checked",!0).trigger("change").next(".recommendation-label").show(),this.$('input[type="radio"][value="reject"]').prop("checked",!1).removeClass("ai-decision"),this.$(".decision-container").addClass("decision-container-accept")},setAIAffiliateRejected:function(){this.$('input[type="radio"][value="reject"]').prop("checked",!0).trigger("change").next(".recommendation-label").show(),this.$('input[type="radio"][value="accept"]').prop("checked",!1).removeClass("ai-decision"),this.$(".decision-container").addClass("decision-container-reject")},setAllButtonsDisabled:function(disabled){this.setActionButtonsDisabled(disabled),this.setDecisionRadiosDisabled(disabled),this.setAskAIButtonDisabled(disabled)},setActionButtonsDisabled:function(disabled){this.$('input[name="exit"]').prop("disabled",disabled),this.$('input[name="continue"]').prop("disabled",disabled)},setDecisionRadiosDisabled:function(disabled){this.$('input[type="radio"][value="reject"]').prop("disabled",disabled),this.$('input[type="radio"][value="accept"]').prop("disabled",disabled),this.$('input[type="radio"][value="undecided"]').prop("disabled",disabled)},setAskAIButtonDisabled:function(disabled){var $askAIButton=this.$('input[name="ask-ai"]');$askAIButton.prop("disabled",disabled),this.hideAskAIButton(disabled),disabled?$askAIButton.parent().addClass("disabled"):$askAIButton.parent().removeClass("disabled")},aiStreamContent:function(selector,content,func){for(var _this2=this,$area=this.$(selector),speed=20,time=speed,words=content.split(" "),i=($area.html(""),0);i<words.length;i++)(i=>{window.setTimeout(function(){return $area.append(words[i]+" ")},time+=Math.floor(Math.random()*(8*speed-speed+speed)))})(i);var interval=window.setInterval(function(){$area.val().trim()===content.trim()&&("function"!=typeof func?window.clearInterval(interval):func(_this2))},500)},secureDataForProxy:function(hash,affiliateID,then){jQuery.ajax({url:this.ajaxURL,method:"GET",dataType:"json",data:{hash:hash,action:"secure_affiliate_review_data",affiliate_id:affiliateID,site:this.siteURL,_ajax_nonce:this.nonce},error:function(data){affiliatewp.affiliateReview.handleError("ai","ajax_failed",affiliatewp.affiliateReview.i18n.ajaxError,data)},success:function(response){var _response$data$reason;response.success||affiliatewp.affiliateReview.handleError(null!=(_response$data$reason=response.data.reason)?_response$data$reason:"unknown",null!=(_response$data$reason=response.data.message)?_response$data$reason:"There was an error securing data for AI.",response),then.bind(affiliatewp.affiliateReview)(null!=(_response$data$reason=response.data.secureJSON)?_response$data$reason:"",hash)}})},handleError:function(feature,error,message,data){return this.setAIError("ai"===feature,error),this.setAllButtonsDisabled(!1),this.setAskingAI(!1),"invalid_license_key"===error?this.displayLicenseErrorModal():"not_enough_credits"===error&&!1===data.customer_purchased_credit_types.monthly_addon?this.displayMonthlyCreditsPurchaseModal(data.purchase_urls.monthly_addon):"not_enough_credits"===error&&!0===data.customer_purchased_credit_types.monthly_addon?this.displayRanOutOfCreditsModal():"spending_too_many_credits"===error?this.displayMoreCreditModal(null!=(feature=data.max_credits)?feature:0,null!=(error=data.required_credits)?error:0):(window.alert(message),void console.warn(data))},displayLicenseErrorModal:function(){this.setAllButtonsDisabled(!1);var modal=this.modal(this.i18n.modals.invalidLicense.title,this.i18n.modals.invalidLicense.description,"",{settings:{text:this.i18n.modals.invalidLicense.buttons.settings.title,action:function(){modal.close(),window.open("admin.php?page=affiliate-wp-settings","_blank")},disabled:!1,btnClass:"btn-confirm"},purchase:{text:this.i18n.modals.invalidLicense.buttons.purchase.title,action:function(){modal.close(),window.open("https://affiliatewp.com/ai/reviews/invalid-license/","_blank")},disabled:!1,btnClass:"btn"},help:{text:this.i18n.modals.invalidLicense.buttons.help.title,action:function(){modal.close(),window.open("https://affiliatewp.com/ai/reviews/invalid-license/support/","_blank")},disabled:!1,btnClass:"btn"}},{boxWidth:585})},displayMonthlyCreditsPurchaseModal:function(purchaseURL){this.setAllButtonsDisabled(!1);var modal=this.modal(this.i18n.modals.purchaseMonthly.title,this.i18n.modals.purchaseMonthly.description,"",{purchase:{text:this.i18n.modals.purchaseMonthly.buttons.purchase.title,action:function(){window.open(purchaseURL,"_blank"),modal.close()},disabled:!1,btnClass:"btn-confirm"}})},displayRanOutOfCreditsModal:function(){this.setAllButtonsDisabled(!1);var modal=this.modal(this.i18n.modals.purchaseTopup.title,this.i18n.modals.purchaseTopup.description,"",{purchase:{text:this.i18n.modals.purchaseTopup.buttons.purchase.title,action:function(){window.open("https://affiliatewp.com/ai/reviews/no-credits/","_blank"),modal.close()},disabled:!1,btnClass:"btn-confirm"}})},displayMoreCreditModal:function(maxCredits,requiredCredits){var _this3=this,modal=this.modal(this.i18n.modals.requiredCredits.title,this.i18n.modals.requiredCredits.description.replace("${credits}",requiredCredits),"",{yes:{text:this.i18n.modals.requiredCredits.buttons.yes.title.replace("${credits}",requiredCredits),action:function(){_this3.force=!0,_this3.$('button[name="ask-ai"]').click(),modal.close()},disabled:!1,btnClass:"btn-confirm"},no:{text:this.i18n.modals.requiredCredits.buttons.no.title,action:function(){modal.close()},disabled:!1,btnClass:"btn"}})},modal:function(title,content,icon,buttons,args){return jQuery.alert(jQuery.extend({backgroundDismiss:!0,title:title,icon:icon,type:"lightgreen",content:content,boxWidth:550,useBootstrap:!1,theme:"modern,affiliatewp-education",closeIcon:!0,draggable:!1,dragWindowBorder:!1,buttons:buttons},args))},makeProxyAIRequest:function(secureJSON,hash,then){jQuery.ajax({url:this.proxyUrl+"/wp-json/ai/v1/affiliate-review/",method:"POST",dataType:"json",data:{hash:hash,secure_json:secureJSON,site:this.siteURL,language:this.language,force:this.force?"yes":"no"},error:function(data){affiliatewp.affiliateReview.handleError("ai","ajax_failed",affiliatewp.affiliateReview.i18n.ajaxError,data)},success:function(aiResponse){var _aiResponse$error;affiliatewp.affiliateReview.logUsage(aiResponse),!aiResponse.hasOwnProperty("error")&&aiResponse.hasOwnProperty("ai_reason")&&aiResponse.hasOwnProperty("ai_status")?then.bind(affiliatewp.affiliateReview)(null!=(_aiResponse$error=aiResponse.ai_status)?_aiResponse$error:"",null!=(_aiResponse$error=aiResponse.ai_reason)?_aiResponse$error:"",null!=(_aiResponse$error=aiResponse.ai_rejection_message)?_aiResponse$error:"",null!=(_aiResponse$error=aiResponse.available_applications)?_aiResponse$error:0,aiResponse):affiliatewp.affiliateReview.handleError("ai",null!=(_aiResponse$error=aiResponse.error)?_aiResponse$error:"unknown",null!=(_aiResponse$error=aiResponse.message)?_aiResponse$error:"There was an unknown error, please try again.",aiResponse)}})}},window.affiliateWPAffiliateReview||{},!0),affiliatewp.affiliateReview.$ready()):console.warn("Cannot attach to window.affiliatewp, was it properly enqueued?")});