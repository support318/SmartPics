function _typeof(o){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o})(o)}jQuery(document).ready(function($){var AffWP_Batch={init:function(){this.submit()},submit:function(){var self=this;$(".affwp-batch-form").each(function(){$(this).on("submit",function(event){event.preventDefault();var ays,event=$(this).find('input[type="submit"]');event.hasClass("button-disabled")||void 0!==(ays=$(this).data("ays"))&&!confirm(ays)||("generate-payouts"===(ays={batch_id:$(this).data("batch_id"),nonce:$(this).data("nonce"),form:$(this).serializeAssoc()}).batch_id&&($("#cancel-new-payout").remove(),event.remove()),event.addClass("button-disabled"),$(this).find(".notice-wrap").remove(),$(this).append('<div class="notice-wrap"><div class="affwp-batch-progress"><div></div></div></div>'),event.parent().append('<span class="spinner is-active"></span>'),self.process_step(1,ays,this))})})},process_step:function(step,data,form){var self=this;form=$(form),$.ajax({type:"POST",url:ajaxurl,data:{batch_id:data.batch_id,action:"process_batch_request",nonce:data.nonce,form:data.form,step:step,data:data},dataType:"json",success:function(response){if(response.data.done||response.data.error){var spinner=form.find(".spinner"),notice_wrap=form.find(".notice-wrap"),dismiss_on_complete=!0===form.data("dismiss-when-complete");if(!1==dismiss_on_complete&&form.find(".button-disabled").removeClass("button-disabled"),response.data.error)spinner.remove(),notice_wrap.html('<div class="updated error"><p>'+response.data.error+"</p></div>");else if(response.data.done){if(spinner.remove(),""!==response.data.message&&notice_wrap.html('<div id="affwp-batch-success" class="updated notice"><p class="affwp-batch-success">'+response.data.message+"</p></div>"),response.data.url){try{new URL(response.data.url)}catch(error){throw new Error("Invalid URL: ".concat(error))}window.location=response.data.url}!0==dismiss_on_complete&&setTimeout(function(){form.parent(".notice").remove()},""===response.data.message?0:3e3)}else notice_wrap.remove()}else form.find(".affwp-batch-progress div").animate({width:response.data.percentage+"%"},50,function(){}),self.process_step(parseInt(response.data.step),data,form)}}).fail(function(response){window.console&&window.console.log&&console.log(response)})}};AffWP_Batch.init(),$.extend({},AffWP_Batch,{submit:function(){var self=this;$(".affwp-batch-import-form").each(function(index,obj){$(this).ajaxForm({beforeSubmit:self.before_submit,complete:self.complete,dataType:"json",error:self.error,data:{action:"process_batch_import",batch_id:$(this).data("batch_id"),nonce:$(this).data("nonce")},url:ajaxurl,resetForm:!0})})},before_submit:function(arr,$form,options){var notice_wrap;if($form.find(".notice-wrap").remove(),$form.append('<div class="notice-wrap"><span class="spinner is-active"></span><div class="affwp-batch-progress"><div></div></div></div>'),!(window.File&&window.FileReader&&window.FileList&&window.Blob))return notice_wrap=($form=$(".affwp-batch-import-form").find(".affwp-batch-progress").parent().parent()).find(".notice-wrap"),$form.find(".button-disabled").removeClass("button-disabled"),notice_wrap.html('<div class="update error"><p>'+affwp_batch_vars.unsupported_browser+"</p></div>"),!1},success:function(responseText,statusText,xhr,$form){console.log($form)},complete:function(xhr){var $form,select,options,columns,selectName,currentSelect,processedColumnValue,response=jQuery.parseJSON(xhr.responseText);response.success?(($form=$(".affwp-batch-import-form .notice-wrap").parent()).find(".affwp-import-file-wrap, .notice-wrap").remove(),$form.find(".affwp-import-options").slideDown(),(select=$form.find("select.affwp-import-csv-column")).parent().parent(),options="",columns=response.data.columns.sort(function(a,b){return a<b?-1:b<a?1:0}),$.each(select,function(selectKey,selectValue){currentSelect=$(this),selectName=$(selectValue).attr("name"),$.each(columns,function(columnKey,columnValue){processedColumnValue=columnValue.toLowerCase().replace(/ /g,"_"),processedColumnValue=new RegExp("\\["+processedColumnValue+"\\]"),selectName.length&&selectName.match(processedColumnValue)?(options+='<option value="'+columnValue+'" selected="selected">'+columnValue+"</option>",0!=response.data.first_row[columnValue]?currentSelect.parent().next().html(response.data.first_row[columnValue]):currentSelect.parent().next().html("")):options+='<option value="'+columnValue+'">'+columnValue+"</option>"}),$(this).append(options),options=""}),select.on("change",function(){var $key=$(this).val();$key&&0!=response.data.first_row[$key]?$(this).parent().next().html(response.data.first_row[$key]):$(this).parent().next().html("")}),$("body").on("click",".affwp-import-proceed",function(event){if(event.preventDefault(),$form.data("required")){var field,tableRow,event=$form.data("required"),requiredFields=[],requiredFields=event.indexOf(",")?event.split(","):[event],triggerValidation=!1;if($.each(requiredFields,function(key,value){field=$("select[name='affwp-import-field["+value+"]']"),(tableRow=field.parent().parent()).removeClass("affwp-required-import-field"),""==field.val()&&(triggerValidation=!0,tableRow.addClass("affwp-required-import-field"),field.parent().next().html(affwp_batch_vars.import_field_required))}),triggerValidation)return}$form.find(".notice-wrap").remove(),$(this).parent().append('<span class="spinner is-active"></span>'),$form.append('<div class="notice-wrap"><div class="affwp-batch-progress"><div></div></div></div>'),response.data.mapping=$form.serialize(),response.data.form=$form.serializeAssoc(),AffWP_Batch.process_step(1,response.data,$form)})):this.error(xhr)},error:function(xhr){var xhr=jQuery.parseJSON(xhr.responseText),import_form=$(".affwp-batch-import-form").find(".affwp-batch-progress").parent().parent(),notice_wrap=import_form.find(".notice-wrap");import_form.find(".button-disabled").removeClass("button-disabled"),xhr.data.error?notice_wrap.html('<div class="update error"><p>'+xhr.data.error+"</p></div>"):notice_wrap.remove()}}).init(),$.extend({isArray:function(arr){return!(!arr||"object"!=_typeof(arr)||arr.constructor!=Array)},arrayMerge:function(){for(var v,a={},n=0,argv=arguments,i=0;i<argv.length;i++)if($.isArray(argv[i])){for(var j=0;j<argv[i].length;j++)a[n++]=argv[i][j];a=$.makeArray(a)}else for(var k in argv[i])isNaN(k)?("object"==_typeof(v=argv[i][k])&&a[k]&&(v=$.arrayMerge(a[k],v)),a[k]=v):a[n++]=argv[i][k];return a},count:function(arr){if($.isArray(arr))return arr.length;var k,n=0;for(k in arr)isNaN(k)||n++;return n}}),$.fn.extend({serializeAssoc:function(){for(var o={aa:{},add:function(name,value){var v,tmp=name.match(/^(.*)\[([^\]]*)\]$/);tmp?(v={},tmp[2]?v[tmp[2]]=value:v[$.count(v)]=value,this.add(tmp[1],v)):"object"==_typeof(value)?("object"!=_typeof(this.aa[name])&&(this.aa[name]={}),this.aa[name]=$.arrayMerge(this.aa[name],value)):this.aa[name]=value}},a=$(this).serializeArray(),i=0;i<a.length;i++)o.add(a[i].name,a[i].value);return o.aa}})});